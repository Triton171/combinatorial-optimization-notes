\documentclass[11pt, a4paper]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{csquotes}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[hidelinks]{hyperref}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.markings}
\usetikzlibrary{arrows.meta}
% Algorithms
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\SetKwInput{KwInput}{Input}
\SetKwInput{KwOutput}{Output}
\DontPrintSemicolon
%Define short commands for different letters
\foreach \x in {A,...,Z}{
\expandafter\xdef\csname b\x\endcsname{\noexpand\mathbb{\x}}
\expandafter\xdef\csname c\x\endcsname{\noexpand\mathcal{\x}}
\expandafter\xdef\csname f\x\endcsname{\noexpand\mathfrak{\x}}
}
% Math shortcuts
\newcommand{\stackalign}[2]{\stackrel{\mathclap{#1}}{#2}}
\renewcommand{\bar}[1]{\overline{#1}}
\renewcommand{\hat}[1]{\widehat{#1}}
\newcommand{\floor}[1]{\lfloor #1 \rfloor}
\newcommand{\ceil}[1]{\lceil #1 \rceil}
\newcommand{\abs}[1]{\left\lvert#1\right\rvert}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\set}[1]{\{#1\}}
\renewcommand{\d}{\mathop{}\!\mathrm{d}}
\DeclareMathOperator{\Id}{Id}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\End}{End}

\newenvironment{graph}[1][]{
	\begin{tikzpicture}[
		vertex/.style={circle,fill,inner sep=0,minimum size=5},
		dedge/.style={-Stealth},
		#1
	]
}{\end{tikzpicture}}

% Theorems, definitions, etc.
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem*{problem}{Problem}

\setcounter{section}{-1}

\title{Combinatorial Optimization}
\author{Dozent: Stephan Held}



\begin{document}
\maketitle
\tableofcontents
\clearpage

\section{Organization}
\begin{itemize}
	\item Prerequisites
	\begin{itemize}
		\item Basic knowledge of graph algorithms
		\item Linear Programming (LP Duality)
		\item Programming skills in C++
	\end{itemize}

	\item Exam
	\begin{itemize}
		\item Qualification requires 50\% of the points in theoretical \&
		programming exercises
		\item Oral exam
	\end{itemize}

	\item Books
	\begin{itemize}
		\item ''Combinatorial Optimization'', Korte \& Vygen
		\item ''Understanding \& Using Linear Programming'', B. Gärtner,
		J. Matouset
		\item Skript (theorems \& definitions)
		\item Further book recommendations are on the website
	\end{itemize}
\end{itemize}




\section{Matchings}
\subsection{Introduction}

\begin{definition}\ 
\begin{enumerate}
	\item A \emph{matching} $M$ in a graph $G=(V,E)$ is a set of
	pairwise disjointed edges, i.e. they don't have a common endpoint.

	$\nu(G)\coloneqq$ max. cardinality of a matching in $G$

	\item An \emph{edge cover} $C$ of a graph $G=(V,E)$ is a subset
	of $E$ s.t.  $V=\bigcup_{e\in C}e$.

	$\zeta(G) \coloneqq$ min. cardinality of an edge cover in $G$
	
	\item A matching is called \emph{perfect} (or \emph{1-factor})
	if it is an edge cover
	
	\item $v\in V$ with $v\in e\in M$ is called \emph{$M$-covered}
	
	\item $v\in V$ is called \emph{$M$-exposed} if it is not
	$M$-covered
\end{enumerate}
\end{definition}

\begin{definition}\ 
\begin{enumerate}
	\item A \emph{stable set} (independent set) $S$ is a set of
	pairwise non-adjacent vertices.
	
	$\alpha(G)\coloneqq$ max. cardinality of a stable set
	
	\item A \emph{vertex cover} $C$ is a subset of $V$ s.t.
	$E=\bigcup_{\{x,y\}\in E,\ x\in G}\{x,y\}$
	
	$\tau(G)\coloneqq$ min. cardinality of a vertex cover
\end{enumerate}
\end{definition}

\begin{lemma}\ 
\begin{enumerate}
	\item $\alpha(G)+\tau(G) = \abs{V}$
	\item $\nu(G) + \zeta(G) = \abs{V}$ if $G$ has no isolated vertices
	\item $\zeta(G)=\alpha(G)$ if $G$ is bipartite and has no isolated
	vertices
\end{enumerate}
\end{lemma}

\begin{problem}{Cardinalty Matching Problem}\\
	Input: Graph $G=(V,E)$ \\
	Task: Find a maximum cardinality matching
\end{problem}

\begin{problem}{Maximum Weight Matching Problem (MWMP)}\\
	Input: Graph $G$, $c:E\to \bR$ \\
	Task: Find a matching $M$ maximizing $c(M)$
\end{problem}

\begin{problem}{Minimum Weight Perfect Matching (MWPMP)}\\
	Input: Graph $G$, $c:E\to\bR$\\
	Task: Find a perfect matching of minimum weight or decide that no
	perfect matching exists in $G$
\end{problem}

\begin{lemma}
	The MWMP is equivalent to the MWPMP (i.e. there exists a transformation
	with linear complexity)
\end{lemma}
\begin{proof}
	Given a MWPMP instance $(G,c)$, define $c':=K-c$
	($K\coloneqq 1+\sum_{e\in E}\abs{c(e)}$). \\
	$\Rightarrow$ Any maximum weight matching is a maximum cardinality
	matching
	
	Given a MVMP instance $(G,c)$, define $G'$ as 2 copies of $G$ where
	the 2 copies of a vertex are joined by an edge. \\
	$\Rightarrow$ $G'$ has a perfect matching. Define:
	\[c'(e)\coloneqq \begin{cases}
		-c(e) \quad&\text{if $e$ is in the first copy} \\
		0 &\text{else}
	\end{cases}\]
	A minimum weight perfect matching in $G'$ gives us a maximum weight
	matching in $G$.
\end{proof}

\begin{definition}
	Let $G=(V,E)$ be a graph and $M\subseteq E$ a matching in $G$.
	A path $P$ is \emph{$M$-alternating} if its edges are alternatingly
	in and not in $M$. If both end points of this path are $M$-exposed,
	$P$ is an \emph{$M$-augmenting} path.
\end{definition}

\begin{lemma}
	Given a matching $M$ in $G$ and an inclusion-wise maximal
	$M$-alternating path $P$,
	\[M\Delta P\coloneqq M\setminus P\cup P\setminus M\]
	is a matching. If $P$ is $M$-augmenting, then
	$\abs{M\Delta P}=\abs{M}+1$.
\end{lemma}

\begin{theorem}[Petersen 1891, Berge 1957]{Augmenting Path Theorem}
	Given a graph $G=(V,E)$ and a matching $M$ in $G$:
	\[\abs{M}=\nu(G) \Leftrightarrow \not\exists \text{$M$-augmenting
	path $P$ in $G$}\]
\end{theorem}
\begin{proof}\ 
\begin{enumerate}
	\item[''$\Rightarrow$'':] Clear
	\item[''$\Leftarrow$'':] Assume there exists a matching $M'$
	with $\abs{M'}>\abs{M}$. Let $G'\coloneqq (V, M\Delta M')$. \\
	$\Rightarrow$ $\abs{\delta_{G'}(v)}\leq 2\ \forall v\in V$ \\
	$\Rightarrow G'$ is the union of disjoint circuits and paths \\
	$\Rightarrow$ all circuits are even and have the same number of edges
	from $M$ and $M'$ \\
	$\Rightarrow \exists$ a path $P$ in $G'$ starting and ending with an
	edge in $M'$ \\
	$\Rightarrow P$ is an alternating path
\end{enumerate}
\end{proof}

\subsection{Bipartite Matching}

\begin{theorem}[König 1931]\label{thm:koenig-bipartite}
	If $G$ is bipartite, then $\nu(G)=\tau(G)$
\end{theorem}
\begin{proof}
	Add vertices $s$ and $t$ edges between them to all vertices of the
	respective partition. Direct all edges from $s$ to $t$. Then
	$\nu(G)$ is maximum number of disjoint $s$-$t$-paths. Menger
	$\Rightarrow$ This is equal to the minimum number of vertices that
	disconnect $t$ from $s$.
\end{proof}

\begin{figure}
\centering
\begin{graph}
	\node[vertex] (s) at (-2,0) {};
	\node[vertex] (a1) at (0,1) {};
	\node[vertex] (a2) at (0,0) {};
	\node[vertex] (a3) at (0,-1) {};
	\node[vertex] (b1) at (2,0.5) {};
	\node[vertex] (b2) at (2,-0.5) {};
	\node[vertex] (t) at (4,0) {};
	\node (sl) [above=0 of s] {$s$};
	\node (tl) [above=0 of t] {$t$};
	\node (al) at (0,1.5) {$A$};
	\node (bl) at (2,1.5) {$B$};
	
	\draw[dedge] (s) -- (a1);
	\draw[dedge] (s) -- (a2);
	\draw[dedge] (s) -- (a3);
	\draw[dedge] (a1) -- (b1);
	\draw[dedge] (a1) -- (b2);
	\draw[dedge] (a2) -- (b2);
	\draw[dedge] (a3) -- (b2);
	\draw[dedge] (b1) -- (t);
	\draw[dedge] (b2) -- (t);
\end{graph}
\caption{Example of the construction in Theorem \ref{thm:koenig-bipartite}}
\end{figure}

\begin{theorem}[Hall 1935]
	Let $G=(A\dot\cup B, E)$ be a bipartite graph. Then:
	\[
		G\text{ has a matching covering $A$}\Leftrightarrow
		\abs{\Gamma(X)} \geq \abs{X} \quad\forall X\subseteq A
	\]
\end{theorem}

\begin{cor}{Marriage Theorem}
	\[
		\abs{\Gamma(X)}\geq\abs{X}\ \forall X\subseteq A\text{ and }
		\abs{A}=\abs{B} \Leftrightarrow G \text{ has a perfect matching}
	\]
\end{cor}

% Numbering is broken in the lecture
\stepcounter{theorem}

\begin{definition}
	The MWPMP for bipartite graphs is called \emph{Assignment Problem}.
\end{definition}

\begin{theorem}
	The Assignment Problem can be solved in time $O(nm+n^2\log m)$.
\end{theorem}
\begin{proof}
	Use the Successive Shortest Paths algorithm in an auxiliary graph.
\end{proof}


\subsection{The Tutte Matrix \& Randomized Matching}

\begin{definition}
	Let $G$ be a simple, undirected graph. Let $G'$ be an orientation
	of $G$ and $(X_e)_{e\in E(G)}$. The \emph{Tutte matrix} is defined as
	\[T_G(X)\coloneqq (T^*_{vw})_{v,w\in V(G)}\]
	where
	\[
		t^*_{vw}\coloneqq \begin{cases}
			X_{\{v,w\}} \quad&\text{if $(v,w)\in E(G)$} \\
			-X_{\{v,w\}} &\text{if $-(v,w)\in E(G)$} \\
			0 &\text{else}
		\end{cases}
	\]
\end{definition}

\begin{remark}
	$T_G(X)$ is shew-symmetric (i.e. $T_G(X)=-(T_G(X))^t$).
	$\mathrm{rank}(T_G(X))$ is independent of the orientation of $G$.
	$\det(T_G(X))$ is a polyomial in $X$.
\end{remark}


\begin{theorem}[Tutte]
	A simple graph $G$ has a perfect matching $\Leftrightarrow
	\det(T_G(X))\neq0$
\end{theorem}
\begin{proof}
	Let $V(G)=\{v_1,\ldots,v_n\}$ and $S_n$ be the permutation group.
	\begin{align*}
		\det T_G(X)=\sum_{\pi\in S_n}\mathrm{sgn}\pi\cdot \prod_{i=1}^n
		t_{v_i,v_{\pi(i)}}^*
	\end{align*}
	Let $S_n'\coloneqq\{\pi\in S_n\ |\ \prod_{i=1}^n
	t_{v_i,v_{\pi_i}}^*\neq0\}$. Each $\pi\in S_n$ corresponds to a
	digraph $H_\pi\coloneqq (V(G), \{(v_i,v_{\pi(i)})\ |\ i\in [n]\footnote{
		This is an abbreviation for $\{1,\ldots,n\}$.
	}\})$.
	We have $\abs{\delta^+(v)=1=\abs{\delta^-(v)}}\ \forall v\in V(H_\pi)$
	$\Rightarrow H_\pi$ is the union of disjoint circuits.
	If $\pi\in S_n'$, then $H_\pi\subset \stackrel{\Leftrightarrow}{G'}$.

	If there exists $\pi\in S_n'$ s.t. $H_\pi$ is a collection of even
	circuits, then this immediately yields a perfect matching in $G$
	(using every second edge of each circuit).
	
	Otherwise, $\forall \pi\in S_n'$, $H_\pi$ contains an odd circuit.
	Let $r(\pi)\in S_n'$ arise from $\pi$ by reversing edges on the unique
	odd circuit containing a vertex with minimum index $\Rightarrow 
	r(r(\pi))=\pi$ and $\mathrm{sgn}(\pi)=\mathrm{sgn}(r(\pi))$.
	The second part is true since for reversing an odd cycle, we need
	an even number of swaps.  Let $v_{i_1},\ldots,v_{i_{2k+1}}$ be the
	''first'' odd circuit.	Then $r(\pi)$ is attained by $2k$ swaps:
	For $j=1,\ldots,k$ swap $(\pi(i_{2j-1}), \pi(i_{2k}))$ and
	$(\pi(i_{2j}), \pi(i_{2k+1}))$.
	
	$\prod_{i=1}^n t_{v_iv_{\pi(i)}}^*=-\prod_{i=1}^nt_{v_iv_{r(\pi(i))}}^*$
	since there is an odd number of sign changes to $t^*$.
	$\Rightarrow \det(T_G(X))=0$. We have shown that if $G$ has no perfect
	matching, then $\det T_G(X)=0$.
	
	Assume that $G$ has a perfect matching $M$. Define $\pi$ as
	$\pi(i)=j, \pi(j)=i$ where $\{i,j\}\in M$.
	$\Rightarrow \prod_{i=1}^n t_{v_iv_{\pi(i)}}^*=\prod_{e\in M}-X_e^2$
	cannot be canceled out. In particular, $\det T_G(X)\neq0$.
\end{proof}

\begin{remark}
	Picking $X'\in [0,1]^{E(G)}$ at random, we almost surely have (since
	the zero set of a non-zero polynomial is a set of measure zero):
	\[\det T_G(X')\neq0 \Leftrightarrow G\text{ has a perfect matching}\]
\end{remark}

\begin{theorem}[Lovász 1979]
	Let $G$ be a simple graph and $X\in [0,1]^{E(G)}$ chosen randomly.
	Then almost surely $\mathrm{rank}(T_G(X))=2\nu(G)$.
\end{theorem}


\subsection{Tutte's Matching Theorem}
Let $X\subseteq V(G)$. $G-X$ consists of even and odd (in terms of the
number of vertices) connected components. We define $q_G(X)$ to be the
number of odd components in $G-X$.

\begin{definition}
	A graph $G$ satisfies the \emph{Tutte Condition} if $q_G(X)\leq\abs{X}$
	for all $X\subseteq V(G)$. $\emptyset\neq X\subseteq V(G)$ is called
	\emph{barrier} if $q_G(X)=\abs{X}$.
\end{definition}

\begin{prop}\label{prop:tutte-even}
	For any graph $G$ and any $X\subseteq V(G)$:
	\[q_G(X)-\abs{X} \equiv \abs{V(G)}\mod 2\]
\end{prop}

\begin{definition}
	A graph $G$ is \emph{factor-critical} if $G-v$ has a perfect matching
	for all $v\in V(G)$. A matching is called \emph{near-perfect} if it
	covers $\abs{V(G)}-1$ vertices.
\end{definition}

\begin{prop}\label{prop:factor-critical-conn}
	 If $G$ is factor-critical, then it is connected.
\end{prop}

\begin{theorem}[Tutte 1947]
	A graph $G$ has a perfect matching $\Leftrightarrow$ Tutte Condition
	holds (i.e. $q_G(X)\leq\abs{X}\ \forall X\subseteq V(G)$)
\end{theorem}
\begin{proof}\ 
\begin{enumerate}
	\item[''$\Rightarrow$'':] Clear
	\item[''$\Leftarrow$'':] We proceed by induction on $\abs{V(G)}$.
	The case $\abs{V(G)}=2$ is clear.
	
	Generally, if the Tutte Condition holds, then $\abs{V(G)}$ must be
	even (pick $X=\emptyset$).
	Proposition \ref{prop:tutte-even} $\Rightarrow q_G(X)-\abs{X}$ is even.
	Every $x\in V(G)$ induces a barrier $\{x\}$. Let $X$ be a maximum
	barrier. Then $G-X$ doesn't have any even components (since otherwise
	a single vertex of such a component could be added to $X$).
	
	\textbf{Claim:} Each odd component is factor-critical. \\
	Let $C$ be an odd component in $G-X$, $v\in V(C)$. Assume that $C-v$
	does not have a perfect matching. Induction Hypothesis $\Rightarrow$
	$C-v$ violates Tutte Condition. \\
	$\Rightarrow \exists Y\subseteq V(C-v): q_{C-v}(Y)>\abs{Y}$ \\
	$\stackrel{\ref{prop:tutte-even}}{\Rightarrow} q_{C-v}(Y)\geq \abs{Y}+2$ \\
	Observe $X\cap\{v\}=Y\cap\{v\}=X\cap Y=\emptyset$:
	\begin{align*}
	q_G(X\cup Y\cup\{v\})&=q_G(X)-1+q_C(Y\cup\{v\}) \\
	&=\abs{X}-1+q_{C-v}(Y) \\
	&\geq\abs{X}-1+\abs{Y}+2 \\
	&=\abs{X\cup Y}+1 \\
	&=\abs{X\cup Y\cup\{v\}}
	\end{align*}
	$\Rightarrow X\cup Y\cup\{v\}$ is a barrier \\
	$\Rightarrow$ Claim
	
	Let $G'$ arise from $G$ by contracting each odd component into a
	single vertex. We have $V(G')=X\dot\cup Z$ and $G'$ is bipartite.
	We have to show that $G'$ has a perfect matching. If not, then
	$\exists A\subseteq Z: \abs{\Gamma_{G'}(A)}<\abs{A}$ \\
	$\Rightarrow q_G(\Gamma_{G'}(A))\geq \abs{A}>\abs{\Gamma_{G'}(A)}$
	which contradicts the Tutte Condition.
\end{enumerate}
\end{proof}

\begin{theorem}[Berge 1958]
	\[\abs{V(G)}=2\nu(G)+\max_{X\subseteq V(G)}(q_G(X)-\abs{X})\]
\end{theorem}
\begin{proof}
For $X\subseteq V(G)$, any matching has at least $q_G(X)-\abs{X}$
uncovered vertices, so ''$\geq$'' holds.

For the other inequality, add $k\coloneqq\max_{X\subseteq V(G)}
(q_G(X)-\abs{X})$ new vertices and connect them to all existing vertices,
yielding a new graph $H$.

We claim that $H$ has a perfect matching. This then implies:
\[2\nu(G)+k\geq 2\nu(H)-k =\abs{V(H)}-k=\abs{V(G)}\]
Assume that $H$ does not have a perfect matching. Then by Tutte's Theorem,
there exists $Y\subseteq V(H)$ with $q_H(Y)>\abs{Y}$. By \ref{prop:tutte-even},
$k\equiv \abs{V(G)}\mod 2$, therefore $\abs{V(H)}$ is even, so $Y\neq\emptyset$.
$Y$ must contain all new vertices, otherwise $H-Y$ would be connected\footnote{
	Note that $Y$ cannot contain all old vertices, since otherwise
	$q_H(Y)<\abs{Y}$.
} and $q_H(Y)\leq 1\leq\abs{Y}$. \\
\[\Rightarrow q_G(Y\cap\abs{V(G)})=q_H(Y)>\abs{Y}=\abs{Y\cap V(G)}+k\]
which is a contradiction to the choice of $k$.
\end{proof}


\subsection{Ear Decompositions of Factor-Critical Graphs}
\begin{definition}
Let $G$ be a graph. An \emph{ear decomposition} of $G$ is a sequence
$r,P_1,\ldots,P_k$ with $G=(r,\emptyset)+P_1+\ldots+P_k$ such that each
$P_i$ is either a path with exactly the endpoints located in
$\set{r}\cup\bigcup_{j\in[i-1]}V(P_j)$ or a circuit where exactly one
of the vertices belongs to $\set{r}\cup\bigcup_{j\in[i-1]}V(P_j)$.

$P_1,\ldots,P_k$ are called \emph{ears}. If $\abs{V(P_1)}\geq 3$ and
$P_2,\ldots,P_k$ are paths we call it a \emph{proper} ear decomposition.
\end{definition}

% Numbering in the lecture is broken
\stepcounter{theorem}

\begin{theorem}[Whitney 1932]
Let $G$ be an undirected graph. Then:
\[G\text{ 2-connected}\Leftrightarrow
	G\text{ has a proper ear decomposition}\]
\end{theorem}

\begin{definition}
An ear decomposition is \emph{odd} if every ear has odd length (in terms
of the number of edges).
\end{definition}

\begin{theorem}
Let $G$ be an undirected graph. Then
\[G\text{ factor-critical}
	\Leftrightarrow G\text{ has an odd ear decomposition}\]
The first vertex $r$ of the ear decomposition can be chosen arbitrarily.
\end{theorem}
\begin{proof}\ 
\begin{enumerate}
\item[''$\Leftarrow$'':]
Let $G$ be a graph with an odd ear decomposition $r,P_1,\ldots,P_k$.
$P_1$ is an odd circuit, so it is factor-critical. We use induction on the
number of ears. Let $P$ be the last ear and $G'$ be $G$ before adding $P$.
By the induction hypothesis, $G'$ is factor-critical.
Given $v\in V(G)$, we have to show that $G-v$ has a perfect matching.
\begin{enumerate}
	\item[Case 1:]
	$v\in V(G')$. Then $G'-v$ has a perfect matching. Adding every second
	edge of $P$ (excluding the endpoints) to it, yields a perfect matching
	of $G-v$.
	
	\item[Case 2:]
	$v\in V(G)\setminus V(G')$. Let $x,y$ be the endpoints of $P$. Without
	loss of generality let $P_{[v,x]}$ be even. There exists a perfect
	matching in $G'-x$. Together with every second edge of $P_{[v,y]}$
	and $P_{[v,x]}$ this is a perfect matching in $G-v$.
\end{enumerate}

\item[''$\Rightarrow$'':]
Let $r\in V(G)$ be any vertex. Let $M$ be a perfect matching in $G-r$.
Suppose we have an odd ear decomposition for $G'\subseteq G$ with
$r\in V(G')$ and $M\cap E(G')$ is a near-perfect matching in $G'$ (i.e.
all vertices in $G'$ except for $r$ are matched with other vertices in $G'$).

If $G'\neq G$, there is an edge $\set{x,y}\in E(G)\setminus E(G')$ with
$x\in V(G')$ (by Proposition \ref{prop:factor-critical-conn}). If
$y\in V(G')$, then $\set{x,y}$ can be chosen as the next ear. Otherwise,
construct an $M$-alternating odd ear, starting with $\set{x,y}$. Let $N$
be a matching in $G-y$. $M\Delta N$ contains a $y$-$r$-path $P$. Let $w$ be
the first vertex in $P\cap V(G')$. $w$ is $M$-exposed in $P_{[y,w]}$, $y$
is $N$-exposed in $P_{[y,w]}$. Therefore $P_{[y,w]}$ is even and together
with $\set{x,y}$ it forms an $M$-alternating odd ear.

Inductively, this argument yields an odd ear decomposition.
\end{enumerate}
\end{proof}

\begin{definition}
Let $G$ be factor-critical and $M$ a near-perfect matching.
An $M$-alternating ear decomposition is an odd ear decomposition
such that each ear is an $M$-alternating path or circuit $C$ with:
\[\abs{E(C)\cap M}=\abs{E(C)\setminus M}-1\]
\end{definition}

\begin{cor}
For any factor-critical graph $G$ and any near-perfect matching $M$ in $G$,
there exists in $M$-alternating ear decomposition of $G$.
\end{cor}

\begin{definition}
Let $G$ be factor-critical, $M$ a near-perfect matching and
$r,P_1,\ldots,P_k$ an $M$-alternating ear decomposition of $G$.
$\mu,\varphi: V(G)\to V(G)$ are \emph{associated with the ear
decomposition} if:
\begin{itemize}
	\item $\set{x,y}\in M\Rightarrow \mu(x)=y$
	\item $\set{x,y}\in E(P_i)\setminus M$ and $x\notin\set{r}
		\cup\bigcup_{j\in [i]}V(P_j)$

		$\Rightarrow \varphi(x)=y$
	\item $\mu(r)=\varphi(r)=r$
\end{itemize}
\end{definition}

% TODO Ear-Decomposition Algorithm

\begin{prop}
Let $G$ be a factor-critical graph and $\mu,\varphi$ functions associated
with an $M$-alternating ear decomposition. Then this ear decomposition is
unique up to the order of the ears. The Ear-Decomposition-Algorithm
correctly determines an explicit list of the ears in linear time.
\end{prop}
\begin{proof}
Step 3 determines ears uniquely. The algorithm clearly runs in linear
time.
\end{proof}

\begin{lemma}
Let $G$ be factor-critical and $\mu,\varphi$ associated with an
$M$-alternating ear decomposition. Then the maximal path given by the
initial sequence
\begin{equation}\label{eq:ear-alt-path}
x,\mu(x),\varphi(\mu(x)),\mu(\varphi(\mu(x))),\ldots
\end{equation}
defines an $M$-alternating $x$-$r$-path of even length.
\end{lemma}
% TODO Counter-example

% Lecture 4, 27.10.22
\begin{proof}
We proceed by induction on the number of ears. Let $x\in
V(G)\setminus\set{r}$ and $P_i$ be the ear containing $x$.
A subsequence of (\ref{eq:ear-alt-path}) is a subpath $Q$ of $P_i$ from
$x$ to $y\in\set{r}\cup\bigcup_{j\in[i-1]}V(P_j)$. $Q$ starts with a
matching edge and ends with a non-matching edge, so it has even length.
If $y=r$, we are done, otherwise the statement follows from the induction
hypothesis.
\end{proof}

\subsection{Edmond's Matching Algorithm}
\begin{definition}
Let $G$ be a graph, $M$ a matching in $G$. A \emph{blossom} in $G$
with respect to $M$ is a factor-critical subgraph of $B$ of $G$ such that
$\abs{M\cap E(B)}=\frac{\abs{V(B)}-1}{2}$. The vertex $r\in V(B)$ that is
exposed by $M$ is called the \emph{base} of $B$.
\end{definition}

\begin{definition}
Let $G$ be a graph, $M$ a matching in $G$, $B$ a blossom and $Q$ a
$M$-alternating $v$-$r$-path of even length from $v\in V(G)$ that is
$M$-exposed to the base $r$ of $B$. Additionally, let
$E(Q)\cap E(B)=\emptyset$. $B+Q$ is called a $M$-flower.
\end{definition}

\begin{lemma}
Let $G$ be a graph, $M$ a matching in $G$. Suppose there is a $M$-flower
$B+Q$. Let $G',M'$ result from $G$ and $M$ by contracting $V(B)$ into
a single vertex. Then:
\[
	M\text{ maximum matching in $G$} \Leftrightarrow
	M\text{ maximum matching in $G'$}
\]
\end{lemma}
\begin{proof}\ 
\begin{enumerate}
\item[''$\Leftarrow$'':]
Assume that $M$ is not maximum in $G$. $N\coloneqq M\Delta E(Q)$
is a matching with $\abs{N}=\abs{M}$. \\
$\Rightarrow \exists N$-augmenting path $P$ in $G$. At least one endpoint
$x$ of $P$ is in $V(B)$. If $P$ and $B$ are disjoint, let $y$ be the other
endpoint of $P$. Otherwise, let $y$ be the first vertex on $P$ in $B$.
$P'\coloneqq P_{[x,y]}$ is an $N'$-augmenting path in $G'$, so
$\abs{N'}=\abs{M'}<\mu(G')$.

\item[''$\Rightarrow$'':]
Assume that $M'$ is not maximum in $G'$, so there exists a matching $N'$
in $G'$ with $\abs{N'}>\abs{M'}$. Let $N_0$ arise from $N'$ in $G$, then
$N_0$ contains $\leq 1$ vertex from $V(B)$. Since $B$ is factor-critical,
$N_0$ can be extended by $k\coloneqq\frac{\abs{V(G)}-1}{2}$ edges to a
matching $N$ in $G$. We have
\[\abs{N}=\abs{N_0}+k=\abs{N'}+k>\abs{M'}+k=\abs{M}\]
so $M$ is not maximum.
\end{enumerate}
\end{proof}

\stepcounter{theorem}
\begin{lemma}
Let $G$ be a graph, $M$ a matching in $G$. $X\subseteq V(G)$ is the set
of exposed vertices. We can find a shortest $M$-alternating $X$-$X$-walk
of positive length in $O(\abs{E(G)})$ time.
\end{lemma}
\begin{proof}
Define $D\coloneqq (V(G), A)$ where:
\[
	A\coloneqq\set{(u,v)\ |\ \exists
	x\in V(G): \set{u,x}\in E(G), \set{x,v}\in M}
\]
A shortest $X-\Gamma_G(X)$-path in $D$ corresponds to a shortest
$X$-$X$-walk in $G$.
\end{proof}

\begin{theorem}\label{thm:augmenting-path-blossom}
Let $P=v_0,\ldots,v_t$ be a shortest $M$-alternating $X$-$X$-walk in $G$.
Then either
\begin{itemize}
	\item $P$ is an $M$-augmenting path \emph{or}
	\item $v_0,\ldots,v_j$ is an $M$-flower for some $j\leq t$.
\end{itemize}
\end{theorem}
\begin{proof}
If $P$ is not a path, choose $i<j$ such that $v_i=v_j$ and $j$ minimal.
Then $v_0,\ldots,v_{j-1}$ are distinct vertices. If $j-i$ is even,
deleting $v_{i-1},\ldots,v_j$ from $P$ yields a shorter walk, so $j-i$
is odd.
\begin{enumerate}
\item[Case 1:] $j$ is even. Then $i$ is odd and therefore $v_{i+1}=v_{j-1}$
must be the matching mate of $V_i=v_j$ which contradicts the minimality of
$j$.
\item[Case 2:] $j$ is odd. Then $i$ is even, so $v_0,\ldots,v_i$ is an
$M$-alternating path of even length and $v_i,\ldots,v_j$ is an
$M$-alternating odd circuit, i.e. a blossom.
\end{enumerate}
\end{proof}

\begin{algorithm}
\caption{Edmond's Augmenting Path Search}
\KwInput{Graph $G$, matching $M$}
\KwOutput{An $M$-augmenting path (if one exists)}
$X\coloneqq$ set of exposed vertices\;
\If{$\exists M$-alternating $X$-$X$-walk of positive length}{
	$P=v_0,\ldots,v_t\coloneqq$ a shortest such walk\;
	\If{$P$ is a path}{
		\KwRet{$P$}\;
	}\Else{
		Choose $j$ as in Theorem \ref{thm:augmenting-path-blossom}\;
		$v_0,\ldots,v_j$ is an $M$-flower with blossom $B$\;
		Recurse on $G/B$\;
		Augment an $M/B$-augmenting path in $G/B$ to an $M$-augmenting
		path $P'$ in $G$\;
		\KwRet{$P'$}\;
	}
}\Else{
	$\not\exists M$-augmenting path\;
}
\end{algorithm}

\begin{theorem}
Given a graph $G$, a maximum cardinality matching can be found in time
$O(n^2m)$ where $n\coloneqq\abs{V(G)}, m\coloneqq\abs{E(G)}$
\end{theorem}
\begin{proof}
Start with $M=\emptyset$ and iteratively find $M$-augmenting path $P$,
set $M\coloneqq M\Delta E(P)$. If no such path exists, then $M$ is
maximum. $P$ can be found in time $O(mn)$\footnote{
	Here, $m$ is the time required for finding a walk and the recursion
	depth is bounded by $n$.
}. Since $M$ is maximum after at most $\frac{n}{2}$ augmentation, we have
total running time $O(n^2m)$.
\end{proof}


\subsubsection{Growing forest\texorpdfstring{ - $O(n^3)$}{}}
\begin{definition}
Let $G$ be a graph, $M$ a matching in $G$. An \emph{alternating forest}
with respect to $M$ in $G$ is a forest $F$ in $G$ where:
\begin{itemize}
	\item $V(F)$ contains all $M$-exposed vertices, each tree of $F$
	contains exactly one exposed vertex, its \emph{root}.
	\item We call $v\in V(G)$ an outer (inner) vertex if it has even
	(odd) distance from the root of its component.
	\item $\forall v\in V(F)$ the unique path from $v$ to the root of
	its component is $M$-alternating.
	\item $v\in V(G)\setminus V(F)$ is called \emph{out-of-forest}.
\end{itemize}
Clearly, inner vertices always have degree 2.
\end{definition}

% TODO: 1.42 in the lecture
\begin{prop}
In any alternating forest, the number of outer vertices that are not the
root equals the number of inner vertices.
\end{prop}
\begin{proof}
For all outer vertices, there exists exactly one inner vertex on its path
to the root.
\end{proof}


\end{document}
